<script>
  const { log, error } = await import('./modules/Logger.js');
  const { WebRTCAPI } = await import('./services/WebRTCAPI.js');
  // RTCPeerConnection

  function sendToLocal() {
    log("sending to local")
    try {
      const json = JSON.parse(document.querySelector("#app").value);
      // TODO: further verification
      //       sqliteWorker.postMessage(JSON.stringify(json))
      log("sending to local:", JSON.stringify(json));
    } catch (e) {
      error(e)
    }
  }

  $("#initializeWithOffer").onclick = () => {
    WebRTCAPI.initializeWithOffer();
  }
  $("#initializeWithAnswer").onclick = () => {
    const text = JSON.parse($("#app").value);
    WebRTCAPI.initializeWithAnswer(text);
  }
  $("#setSDP").onclick = () => {
    const text = JSON.parse($("#app").value);
    WebRTCAPI.setSDP(text);
  }
  $("#sendToRemote").onclick = () => {
    const text = JSON.parse($("#app").value);
    WebRTCAPI.sendToRemote(text);
  }
  // $("#sendToLocal").onclick = sendToLocal;
</script>

<style></style>

<template>
  <p>Please open this view in two tabs (A/B), and keep it open:</p>
  <ol>
    <li>Step 1 on A: Click "Create offer" and copy offer to clipboard.</li>
    <li>Step 2 on B: Paste offer and click "Create answer". Copy answer to clipboard.</li>
    <li>Steb 3 on A: Click "Set remote". The connection should now be established.</li>
    <li>You can now Send messages to remote. Please make sure, they are valid JSON.</li>
  </ol>
  <textarea id="app"></textarea>
  <button id="initializeWithOffer">Step 1 on A: Create offer</button>
  <button id="initializeWithAnswer">Step 2 on B: Create answer</button>
  <button id="setSDP">Step 3 on A: Set remote</button>
  <button id="sendToRemote">Send to Remote</button>
  <!-- <button id="sendToLocal">Send to Local</button> -->
</template>